---
title: "DataInventory"
author: "Zeynep Enkavi"
date: "May 11, 2016"
output: html_document
---

This is an initial markdown file to gather info on all the raw data that I currently have access to.

Rows: Subjects
Column: Demographics, BART, BASC, BIS-BAS, EIS, CARE, DUQ, WASI, MGbehav,MGfmri

Subjects: All subjects should be listed in the FINAL redcap data
Demographics, 
BART: 
BASC: 
BIS-BAS: 
EIS: 
CARE: 
DUQ: 
WASI: 
MGbehav:
MGfmri: Nifti's in ls5

Begin building table: get row info from Redcap data?

Data directories on TACC:
/corral-repl/utexas/poldracklab/users/shelfins/Developmental_Study
/corral-repl/utexas/poldracklab/data/dev_study/

Read in data Redcap/questionnare from TACC. This df holds a record for all subjects that came in.

```{r}
q.data <- read.csv(pipe('ssh -l zenkavi ls5.tacc.utexas.edu "cat /corral-repl/utexas/poldracklab/users/zenkavi/dev_study/data/behav/questionnaire/DevelopmentalStudy_DATA_2015-03-25_1258.csv"'))
```

Create new df to inventory what data is available for each subject.
Begin by creating a `subjects` column using the TACC data that has `subj_id` info.  

```{r}
data.inv <- data.frame(subjects = q.data$subj_id)
```

Function to check the questionnaire data to see if a subject has complete data for a given questionnaire.

```{r}
check_complete <- function(input_df, input_row_name, q_indices, output_df, output_row_name){
  
  #create tmp vector for the output
  tmp <- NA
  
  #loop through each row in output_df (data.inv)
  for (i in 1:nrow(output_df)){
    
    #check age category of subject id
    j <- ifelse(input_df[i,input_row_name]<200000, 1,
                ifelse(input_df[i,input_row_name]>200000&input_df[i,input_row_name]<300000, 2,
                       ifelse(input_df[i,input_row_name]>300000&input_df[i,input_row_name]<400000, 3, 
                              ifelse(input_df[i,input_row_name]>400000, 4, 1))))
    
    #check if questions for that age category are complete  
   tmp[i] <- ifelse(sum(is.na(input_df[input_df[input_row_name] == output_df[i, output_row_name], q_indices[,j]]))>0, 0, 1)
  }

  
  #return tmp output vector
  return(tmp)
}
```

Check complete data for `bisbas`

```{r}
bisbas_qs <- grep('bisbas', names(q.data))

data.inv$bisbas <- check_complete(q.data, "subj_id",  matrix(rep(bisbas_qs,4), ncol=4), data.inv, "subjects")

rm(bisbas_qs)
```

- 406980: missing `bisbas17`
- 400742: missing `bisbas7`
- 100060: missing `bisbas17`
- 100185: missing any `bisbas`
- 100180: missing any `bisbas`
- 100207: missing `bisbas14`
- 100215: missing any `bisbas`
- 100103: missing `bisbas9` and `bisbas12`

Check complete data for `eis`

```{r}
eisy_qs <- grep('eisy', names(q.data))
eisa_qs <- grep('eisa', names(q.data))

data.inv$eis <- check_complete(q.data, "subj_id", matrix(c(eisy_qs, eisy_qs, eisy_qs, eisa_qs),ncol=4), data.inv, "subjects")

rm(eisa_qs, eisy_qs)
```

`eis` administration errors:
- 409850: administered `eisy` instead of `eisa`
- 407260: missing `eisa14`
- 200088: administered `eisa` instead of `eisy` and missing `eisa14`
- 100009: missing `eisy15`
- 100185: missing any `eis`
- 100180: missing any `eis`
- 200213: missing `eisy17`
- 100207: missing `eisy7` and `eis10`
- 100215: missing any `eis` 
- 100152: missing `eisy17`
- 100103: missing `eisy3`
- 100003: missing `eisy10` and `eis13`
- 200249: missing `eisy1`

```{r}
grep('care', names(q.data), value=T)
```

`q.data` should have data for: basc, care, duq, iq

QUESTION: re questionnaire scoring. Some subjects have no data for some questionnaires while others have maybe one question missing. How should I treat those who have some data?

QUESTION: There are some errors in administration (e.g. Older subjects who have been administered the youth scales for certain questionnaires.). What should I do with them?

still to check: bart, mgbehav, mgfmri

Here's what I have on the sample:

`TOTAL SAMPLE DETAILS:
Data were collected from 83 subjects. Three subjects were excluded from all further analyses for reaching clinical criteria on one or more of the following scales from the SRP (atypicality, attention problems, hyperactivity, anxiety, depression). One subject chose to withdraw from the study shortly after entering the scanner, and one subject did not meet age criteria for the study, leaving 78 subjects (30 children, 14 M, 16 F; 26 adolescents, 14 M, 12 F; and 22 adults, 13 F, 9 M).
Of the remaining 78 subjects, two subjects (both female children) did not complete the questionnaires, and two subjects (both female children) did not complete the BART.

From imaging analyses:
Of the remaining 78 subjects, 14 subjects were excluded from the machine game analysis. Eight subjects (5 children, 2 adolescents, 1 adult) were excluded because their data did not fit the model well (solution with the best fit yielded a negative exponent, negative A-neg, or both); six subjects (1 child, 4 adolescents, 1 adult) were excluded due to the accidental deletion of their behavioral data from this task, leaving a machine game sample of 64 subjects (24 children 11 M, 13 F; 20 adolescents, 10 M, 10 F; and 20 adults, 8 M, 12 F).
An additional four subjects (all children) were excluded from the imaging analysis, three due to excess motion (more than 25% of volumes had greater than 0.5 mm framewise displacement), and one due to a scanner malfunction partway through the scan, leaving an imaging sample of 60 subjects (20 children, 11 M, 9 F; 20 adolescents, 10 M, 10 F; 20 adults, 8 M, 12 F).
`

Of the 83 total participants:
3 Clinical criteria subjects: 311444, 100244, 200211
1 decline after scanner: 100215
1 underage: 200213

2 incomplete questionnaires: 100185
2 incomplete BART: 100068

Of the 78 scanned (?) excluded participants:
8 poor behavioral fits: 306587, 200085, 100051, 400742, 100143, 100188, 100180, 100241
6 accidental deletions: 100060, 200027, 411236, 308023, 304228, 200081
3 of motion: 100103, 100104, 100105
1 of scanner malfunction: 100109

QUESTION re imaging data: I have access to the 60 that are deemed 'clean' from previous analyses. But should I replicate this decision by checking behavioral model fits for the 8 subjects excluded for this reason and the 3 that are excluded due to motion? If yes, I'm not sure where to find the images for the 3

(Do I have the behavioral machine game for the 8? - yes)