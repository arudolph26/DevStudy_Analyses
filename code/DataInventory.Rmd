---
title: "DataInventory"
author: "Zeynep Enkavi"
date: "May 11, 2016"
output: html_document
---

This is an initial markdown file to gather info on all the raw data that I currently have access to.

Rows: Subjects
Columns: Demographics, BART, BASC, BIS-BAS, EIS, CARE, DUQ, WASI, MGbehav ,MGfmri

Subjects: All subjects should be listed in the FINAL redcap data
Demographics, 
BART: 
BASC: 

MGbehav:
MGfmri: Nifti's in ls5

Data directories on TACC:
/corral-repl/utexas/poldracklab/users/shelfins/Developmental_Study
/corral-repl/utexas/poldracklab/data/dev_study/

Where I'm keeping copied versions:
/corral-repl/utexas/poldracklab/users/zenkavi/dev_study

Read in data Redcap/questionnare from TACC. This df holds a record for all subjects that came in.

```{r}
q.data <- read.csv(pipe('ssh -l zenkavi ls5.tacc.utexas.edu "cat /corral-repl/utexas/poldracklab/users/zenkavi/dev_study/todo/behav_data_tb_organized/questionnaire/DevelopmentalStudy_DATA_2015-03-25_1258.csv"'))
```

Create new df to inventory what data is available for each subject.
Begin by creating a `subjects` column using the TACC data that has `subj_id` info.  

```{r}
data.inv <- data.frame(subjects = q.data$subj_id)
```

Function to check the questionnaire data to see if a subject has complete data for a given questionnaire.

```{r}
check_complete <- function(input_df, input_row_name, q_indices, output_df, output_row_name){
  
  #create tmp vector for the output
  tmp <- NA
  
  #loop through each row in output_df (data.inv)
  for (i in 1:nrow(output_df)){
    
    #check age category of subject id
    j <- ifelse(input_df[i,input_row_name]<200000, 1,
                ifelse(input_df[i,input_row_name]>200000&input_df[i,input_row_name]<300000, 2,
                       ifelse(input_df[i,input_row_name]>300000&input_df[i,input_row_name]<400000, 3, 
                              ifelse(input_df[i,input_row_name]>400000, 4, 1))))
    
    #check if questions for that age category are complete  
   tmp[i] <- ifelse(sum(is.na(input_df[input_df[input_row_name] == output_df[i, output_row_name], unlist(q_indices[j])]))>0, 0, 1)
  }

  
  #return tmp output vector
  return(tmp)
}
```

Check complete data for `bisbas`

```{r}
bisbas_qs <- grep('bisbas', names(q.data))

data.inv$bisbas <- check_complete(q.data, "subj_id",  list(bisbas_qs, bisbas_qs,bisbas_qs, bisbas_qs), data.inv, "subjects")

rm(bisbas_qs)
```

- 406980: missing `bisbas17`
- 400742: missing `bisbas7`
- 100060: missing `bisbas17`
- 100185: missing any `bisbas`
- 100180: missing any `bisbas`
- 100207: missing `bisbas14`
- 100215: missing any `bisbas`
- 100103: missing `bisbas9` and `bisbas12`

Check complete data for `eis`

```{r}
eisy_qs <- grep('eisy', names(q.data))
eisa_qs <- grep('eisa', names(q.data))

data.inv$eis <- check_complete(q.data, "subj_id", list(eisy_qs, eisy_qs, eisy_qs, eisa_qs), data.inv, "subjects")

rm(eisa_qs, eisy_qs)
```

`eis` administration errors:
- 409850: administered `eisy` instead of `eisa`
- 407260: missing `eisa14`
- 200088: administered `eisa` instead of `eisy` and missing `eisa14`
- 100009: missing `eisy15`
- 100185: missing any `eis`
- 100180: missing any `eis`
- 200213: missing `eisy17`
- 100207: missing `eisy7` and `eis10`
- 100215: missing any `eis` 
- 100152: missing `eisy17`
- 100103: missing `eisy3`
- 100003: missing `eisy10` and `eis13`
- 200249: missing `eisy1`

Check complete for `care`
This should only be true for `subj_id` > 200000 (the youngest group did not complete this questionnaire)

```{r}
care_qs <- grep('care', names(q.data), value=T)

data.inv$care <- check_complete(q.data, "subj_id", list(care_qs, care_qs, care_qs, care_qs), data.inv, "subjects")

data.inv$care <- ifelse(data.inv$subject < 200000, NA, data.inv$care)

rm(care_qs)
```

- 407209: missing `careeb24`
- 409381: missing `career26`
- 200213: missing all `care`
- 200025: : missing `careeb21`

Check complete for `duq`
This should only be true for `subj_id` > 200000 (the youngest group did not complete this questionnaire)

```{r}
duq_qs <- grep('duq', names(q.data), value=T)

data.inv$duq <- check_complete(q.data, "subj_id", list(duq_qs, duq_qs, duq_qs, duq_qs), data.inv, "subjects")

data.inv$duq <- ifelse(data.inv$subject < 200000, NA, data.inv$duq)

rm(duq_qs)
```

306587: missing `duq6`
408988: missing `duq22` and `duq29`
308023: missing `duq17` 
200199: missing `duq19`
200166: missing `duq12`
200213: missing any `duq`

Check complete for `iq`, `vocab_raw` and `mr_raw`

```{r}
data.inv$iq <- check_complete(q.data, "subj_id", list("fsiq2", "fsiq2", "fsiq2", "fsiq2"), data.inv, "subjects")

data.inv$vocab <- check_complete(q.data, "subj_id", list("vocab_raw", "vocab_raw", "vocab_raw", "vocab_raw"), data.inv, "subjects")

data.inv$matrea <- check_complete(q.data, "subj_id", list("mr_raw", "mr_raw", "mr_raw", "mr_raw"), data.inv, "subjects")
```

200088: missing iq 
100180: missing iq, missing vocab, missing matrea  
100215: missing iq, missing vocab, missing matrea
100191: missing vocab, missing matrea
406620: missing matrea

NOTE: There should be a way to convert the raw vocab and matrix reasoning scores to `fsiq2`. Need WASI-II conversion scale for this. This should fix `2000088`. 

Check for complete basc

```{r}
basc_child_qs <- grep('basc[0-9]{1,3}$', names(q.data), value=T)
basc_teen_qs <- grep('basct', names(q.data), value=T)
basc_adult_qs <- grep('basca', names(q.data), value=T)

data.inv$basc <- check_complete(q.data, "subj_id", list(basc_child_qs,basc_teen_qs,basc_teen_qs,basc_adult_qs), data.inv, "subjects")

rm(basc_child_qs, basc_teen_qs, basc_adult_qs)
```

406620: missing `basca150`
408952: missing `basca77` 
100062: completed `basct` instead of `basc`. Age rounds up to 13. Not sure if intentional.
409850: completed `basct` instead of `basca`. Age 29 so not sure why. 
407260: missing `basca4`
200088: missing `basct157`
100009: missing `basc11` and `basc53`
408511: missing `basca156`
100060: completed `basct` instead of `basc`. Even in that missing `basct15`. Age rounds up to 13. Not sure if intentional.
308023: missing `basct51` 
200166: missing `basct19` and `basct109`
200156: missing `basct1` 
100185: missing any `basc`
100180: missing any `basc`
200213: missing `basct31` and `basct95` 
100207: completed `basct` instead of `basc`. Even in that missing `basct4`,`basct17`,`basct56`,`basct139`,`basct154`,`basct157`. Age rounds up to 13. Not sure if intentional.
100215: missing any `basc`
100244: missing `basc29`
100191: completed `basct` instead of `basc`. Age rounds up to 13. Not sure if intentional.
402997: missing `basca98` and `basca128`
100103: completed `basct` instead of `basc`. Age rounds up to 13. Not sure if intentional. Even in that missing half the questions.
100003: missing `basc57` 
200249 missing `basct83`
100250: completed `basct` instead of `basc`. Age rounds up to 13. Not sure if intentional.
100129: completed `basct` instead of `basc`. Age rounds up to 13. Not sure if intentional. 
100247: completed `basct` instead of `basc`. Age rounds up to 13. Not sure if intentional.

Check complete for demographics
age, race, ethnicity, gender

```{r}
data.inv$age <- check_complete(q.data, "subj_id", list("age", "age", "age", "age"), data.inv, "subjects")

data.inv$race <- check_complete(q.data, "subj_id", list("race", "race", "race", "race"), data.inv, "subjects")

data.inv$ethnicity <-check_complete(q.data, "subj_id", list("ethnicity", "ethnicity", "ethnicity", "ethnicity"), data.inv, "subjects")

data.inv$gender <- check_complete(q.data, "subj_id", list("gender", "gender", "gender", "gender"), data.inv, "subjects")
```

100062: missing `race` and `ethnicity`
407260: missing `race` 
100051: missing `race` and `ethnicity`
409381: missing `race` and `ethnicity`
100188: missing `race` and `ethnicity`
100185: missing `race` and `ethnicity` and `gender`
100180: missing `race` and `ethnicity` and `gender`
100215: missing `race` and `ethnicity` and `gender`
100057: missing `ethnicity`
200067: missing `ethnicity`
200199: missing `ethnicity`
100244: missing `ethnicity` 
100103: missing `ethnicity` 
100129: missing `ethnicity`

Check complete for BART

```{r}
bart.mat.list <- read.table(pipe('ssh -l zenkavi ls5.tacc.utexas.edu "ls  /corral-repl/utexas/poldracklab/users/zenkavi/dev_study/todo/behav_data_tb_organized/bart/*.mat"'))

bart.mat.list$V1 <- sub("/corral-repl/utexas/poldracklab/users/zenkavi/dev_study/todo/behav_data_tb_organized/bart/", "",bart.mat.list$V1)

bart.mat.list$subjects<- as.numeric(gsub("([0-9]+).*$", "\\1", bart.mat.list$V1))

data.inv$bart <- ifelse(data.inv$subjects %in% bart.mat.list$subjects == FALSE, 0,1)

bart.mat.list$subjects[which(bart.mat.list$subjects %in% data.inv$subjects ==F)]

rm(bart.mat.list)
```

200067: missing `bart` 
100068: missing `bart` 
100180: missing `bart` 
100215: missing `bart`

200027: subject for whom there is `bart` data but no other behavioral data.

Check complete for Machine Game behavioral

```{r}
mg.csv.list <- read.table(pipe('ssh -l zenkavi ls5.tacc.utexas.edu "ls  /corral-repl/utexas/poldracklab/users/zenkavi/dev_study/todo/behav_data_tb_organized/machine_game/*.csv"'))

mg.csv.list$V1 <- sub("/corral-repl/utexas/poldracklab/users/zenkavi/dev_study/todo/behav_data_tb_organized/machine_game/", "", mg.csv.list$V1)

mg.csv.list$subjects <- as.numeric(sub("ProbLearn","",sub(".csv", "", mg.csv.list$V1)))

data.inv$mg_behav <- ifelse(data.inv$subjects %in% mg.csv.list$subjects == FALSE, 0,1)

mg.csv.list$subjects[which(mg.csv.list$subjects %in% data.inv$subjects == FALSE)]
```

200067: missing `mg_behav` --> should be 200027
411236: missing `mg_behav` 
100060: missing `mg_behav` 
308023: missing `mg_behav` 
304228: missing `mg_behav` 
200081: missing `mg_behav`

1001102 : Additional csv file with subject number more than 6 digits. Presumably a second dataset for subject 100110 but not sure which to use.

Check complete for Machine Game imaging

After moving niftis:
100215: Doesn't have mg behavioral or imaging after run 1 [declined after scanner]
100109: Have behavioral data for all runs but not images after run 1
100169: Have behavioral data for all runs but not images after run 3
200025: No bold for run 6
408511: No bold for run 6
100244: No bold for run 6
100062: No sbref for run 4
100068: No sbref for run 4
200249: No sbref for run 4
200081: Has all images but no behavioral data (acccidental deletion)
411236: Has all images but no behavioral data (acccidental deletion)
200027: Has all images but no behavioral data (acccidental deletion)
407260: Has two complete sets of images. Not sure if duplicate
100060: No phasediff image and no behavioral data for imaging task
308023: Has all images but no behavioral data (acccidental deletion)
406989: Has all images but no behavioral data (acccidental deletion)
304228: Has all images but no behavioral data (acccidental deletion)

Here's what I have on the sample:

`TOTAL SAMPLE DETAILS:
Data were collected from 83 subjects. Three subjects were excluded from all further analyses for reaching clinical criteria on one or more of the following scales from the SRP (atypicality, attention problems, hyperactivity, anxiety, depression). One subject chose to withdraw from the study shortly after entering the scanner, and one subject did not meet age criteria for the study, leaving 78 subjects (30 children, 14 M, 16 F; 26 adolescents, 14 M, 12 F; and 22 adults, 13 F, 9 M).
Of the remaining 78 subjects, two subjects (both female children) did not complete the questionnaires, and two subjects (both female children) did not complete the BART.

Of the 83 total participants:
3 Clinical criteria subjects: 311444, 100244, 200211
1 decline after scanner: 100215
1 underage: 200213
6 accidental behavioral file deletions: 200081, 411236, 200027, 308023, 406989, 304228

From imaging analyses:
Of the remaining 78 subjects, 14 subjects were excluded from the machine game analysis. Eight subjects (5 children, 2 adolescents, 1 adult) were excluded because their data did not fit the model well (solution with the best fit yielded a negative exponent, negative A-neg, or both); six subjects (1 child, 4 adolescents, 1 adult) were excluded due to the accidental deletion of their behavioral data from this task, leaving a machine game sample of 64 subjects (24 children 11 M, 13 F; 20 adolescents, 10 M, 10 F; and 20 adults, 8 M, 12 F).
An additional four subjects (all children) were excluded from the imaging analysis, three due to excess motion (more than 25% of volumes had greater than 0.5 mm framewise displacement), and one due to a scanner malfunction partway through the scan, leaving an imaging sample of 60 subjects (20 children, 11 M, 9 F; 20 adolescents, 10 M, 10 F; 20 adults, 8 M, 12 F).
`

2 incomplete questionnaires: 100185
2 incomplete BART: 100068

Of the 78 scanned (?) excluded participants:
8 poor behavioral fits: 306587, 200085, 100051, 400742, 100143, 100188, 100180, 100241
6 accidental deletions: 100060, 200027, 411236, 308023, 304228, 200081
3 of motion: 100103, 100104, 100105
1 of scanner malfunction: 100109

QUESTION re imaging data: I have access to the 60 that are deemed 'clean' from previous analyses. But should I replicate this decision by checking behavioral model fits for the 8 subjects excluded for this reason and the 3 that are excluded due to motion? If yes, I'm not sure where to find the images for the 3

(Do I have the behavioral machine game for the 8? - yes)

QUESTION: re questionnaire scoring. Some subjects have no data for some questionnaires while others have maybe one question missing. How should I treat those who have some data?

QUESTION: There are some errors in administration (e.g. Older subjects who have been administered the youth scales for certain questionnaires.). What should I do with them?
